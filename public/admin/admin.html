<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - English Learning Platform</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <div class="admin-container">
    <aside class="admin-sidebar">
      <h2>Admin Panel</h2>
      <ul class="admin-menu">
        <li><a href="/admin/admin.html" class="active">Dashboard</a></li>
        <li><a href="/admin/manage-lessons.html">Manage Lessons</a></li>
        <li><a href="/admin/manage-bookings.html">Manage Bookings</a></li>
        <li><a href="/admin/manage-requests.html">Manage Requests</a></li>
        <li><a href="/dashboard.html">User Dashboard</a></li>
        <li><a href="#" onclick="handleLogout()">Logout</a></li>
      </ul>
    </aside>

    <main class="admin-content">
      <div class="admin-header">
        <h1>Admin Dashboard</h1>
      </div>

      <div class="stats-grid">
        <div class="stat-box">
          <h3>Total Users</h3>
          <div class="value" id="total-users">0</div>
        </div>
        <div class="stat-box">
          <h3>Total Lessons</h3>
          <div class="value" id="total-lessons">0</div>
        </div>
        <div class="stat-box">
          <h3>Total Bookings</h3>
          <div class="value" id="total-bookings">0</div>
        </div>
        <div class="stat-box">
          <h3>Active Subscriptions</h3>
          <div class="value" id="active-subscriptions">0</div>
        </div>
        <div class="stat-box">
          <h3>Total Revenue</h3>
          <div class="value" id="total-revenue">$0.00</div>
        </div>
      </div>

      <div class="card" style="margin-top: 2rem;">
        <h2 style="margin-bottom: 1rem;">Recent Payments</h2>
        <div class="table">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>User</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="payments-table">
              <tr>
                <td colspan="6" style="text-align: center; padding: 2rem;">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script>
    // Load admin dashboard data
    document.addEventListener('DOMContentLoaded', async () => {
      if (!requireAdmin()) return;

      try {
        const stats = await adminAPI.getStats();
        document.getElementById('total-users').textContent = stats.totalUsers;
        document.getElementById('total-lessons').textContent = stats.totalLessons;
        document.getElementById('total-bookings').textContent = stats.totalBookings;
        document.getElementById('active-subscriptions').textContent = stats.activeSubscriptions;
        document.getElementById('total-revenue').textContent = `$${stats.totalRevenue.toFixed(2)}`;

        const payments = await adminAPI.getPayments();
        const paymentsTable = document.getElementById('payments-table');
        
        if (payments.length === 0) {
          paymentsTable.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 2rem;">No payments yet</td></tr>';
        } else {
          paymentsTable.innerHTML = payments.slice(0, 10).map(payment => {
            const date = new Date(payment.createdAt).toLocaleDateString();
            const userName = payment.userId?.name || 'N/A';
            const statusClass = payment.status === 'completed' ? 'badge-success' : 
                               payment.status === 'failed' ? 'badge-danger' : 'badge-warning';
            
            return `
              <tr>
                <td>${date}</td>
                <td>${userName}</td>
                <td>${payment.type}</td>
                <td>$${payment.amount.toFixed(2)}</td>
                <td>${payment.paymentMethod}</td>
                <td><span class="badge ${statusClass}">${payment.status}</span></td>
              </tr>
            `;
          }).join('');
        }
      } catch (error) {
        console.error('Error loading admin data:', error);
        if (error.message.includes('authorization') || error.message.includes('token')) {
          authAPI.logout();
        }
      }
    });
  </script>
</body>
</html>


